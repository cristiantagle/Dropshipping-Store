'use client';
import React from "react";
import Link from "next/link";

export type Producto = {
  id: string;
  name: string;
  description: string | null;
  price_cents: number;
  image_url: string | null;
  category_slug: string | null;
  created_at: string;
  envio: string | null;
  destacado: boolean;
  sales: number;
};

type Props = { items: Producto[] };

const FALLBACK = "/lunaria-icon.png";

function fmtCLP(cents: number) {
  return Intl.NumberFormat("es-CL", {
    style: "currency",
    currency: "CLP",
    maximumFractionDigits: 0,
  }).format(cents / 100);
}

export default function ProductListClient({ items }: Props) {
  if (!items || items.length === 0) {
    return <p className="text-gray-600">No hay productos disponibles.</p>;
  }

  return (
    <ul className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
      {items.map((p) => (
        <li key={p.id} className="border rounded-2xl hover:bg-gray-50 transition">
          <Link href={`/producto/${p.id}`} className="block p-4">
            <div className="aspect-[4/3] w-full mb-3 overflow-hidden rounded-xl bg-gray-100">
              <img
                src={p.image_url || FALLBACK}
                alt={p.name}
                className="w-full h-full object-cover"
                loading="lazy"
                decoding="async"
                referrerPolicy="no-referrer"
                onError={(e) => {
                  const img = e.currentTarget as HTMLImageElement;
                  if (img.dataset.fallbackApplied !== "1") {
                    img.dataset.fallbackApplied = "1";
                    img.src = FALLBACK;
                  }
                }}
              />
            </div>
            <h3 className="font-semibold">{p.name}</h3>
            <p className="text-sm text-gray-600">{p.envio || "Envío estándar"}</p>
            <div className="mt-2 flex items-center justify-between">
              <span className="font-bold">{fmtCLP(p.price_cents)}</span>
              <span className="px-3 py-1 rounded-xl bg-black text-white text-sm">Ver</span>
            </div>
          </Link>
        </li>
      ))}
    </ul>
  );
}
